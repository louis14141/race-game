!function(e){function t(t){for(var i,s,o=t[0],l=t[1],h=t[2],u=0,d=[];u<o.length;u++)s=o[u],a[s]&&d.push(a[s][0]),a[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);for(c&&c(t);d.length;)d.shift()();return n.push.apply(n,h||[]),r()}function r(){for(var e,t=0;t<n.length;t++){for(var r=n[t],i=!0,o=1;o<r.length;o++){var l=r[o];0!==a[l]&&(i=!1)}i&&(n.splice(t--,1),e=s(s.s=r[0]))}return e}var i={},a={0:0},n=[];function s(t){if(i[t])return i[t].exports;var r=i[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=i,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=this.webpackJsonp=this.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var h=0;h<o.length;h++)t(o[h]);var c=l;n.push([2,1]),r()}([,function(e,t,r){"use strict";(function(e){r.d(t,"a",function(){return i});class i extends Phaser.Events.EventEmitter{constructor(t,{fov:r=75,aspect:i=null,near:a=.1,far:n=1e3,x:s=0,y:o=0,z:l=0,anisotropy:h=1,antialias:c=!1}={}){super(),this.root=t,this.view=t.add.extern(),this.scene=new e.Scene,this.textureAnisotropy=h,i||(i=t.scale.gameSize.aspectRatio),this.camera=new e.PerspectiveCamera(r,i,a,n),this.camera.position.set(s,o,l),this.renderer=new e.WebGLRenderer({canvas:t.sys.game.canvas,context:t.sys.game.context,antialias:c}),this.renderer.autoClear=!1,this.view.render=(()=>{this.renderer.state.reset(),this.renderer.render(this.scene,this.camera)}),this.add={ambientLight:e=>this.addAmbientLight(e),directionalLight:e=>this.addDirectionalLight(e),hemisphereLight:e=>this.addHemisphereLight(e),pointLight:e=>this.addPointLight(e),spotLight:e=>this.addSpotLight(e),mesh:e=>this.addMesh(e),group:(...e)=>this.addGroup(e),ground:e=>this.addGround(e),box:e=>this.addBox(e),cone:e=>this.addCone(e),circle:e=>this.addCircle(e),cylinder:e=>this.addCylinder(e),dodecahedron:e=>this.addDodecahedron(e),extrude:e=>this.addExtrude(e),lathe:e=>this.addLathe(e),icosahedron:e=>this.addIcosahedron(e),plane:e=>this.addPlane(e),parametric:e=>this.addParametric(e),ring:e=>this.addRing(e),sphere:e=>this.addSphere(e),text:e=>this.addText(e),tube:e=>this.addTube(e),octahedron:e=>this.addOctahedron(e),polyhedron:e=>this.addPolyhedron(e),shape:e=>this.addShape(e),tetrahedron:e=>this.addTetrahedron(e),torus:e=>this.addTorus(e),torusKnot:e=>this.addTorusKnot(e)},this.make={box:e=>this.makeBox(e),cone:e=>this.makeCone(e),circle:e=>this.makeCircle(e),cylinder:e=>this.makeCylinder(e),dodecahedron:e=>this.makeDodecahedron(e),extrude:e=>this.makeExtrude(e),icosahedron:e=>this.makeIcosahedron(e),lathe:e=>this.makeLathe(e),plane:e=>this.makePlane(e),parametric:e=>this.makeParametric(e),ring:e=>this.makeRing(e),sphere:e=>this.makeSphere(e),shape:e=>this.makeShape(e),text:e=>this.makeText(e),tube:e=>this.makeTube(e),octahedron:e=>this.makeOctahedron(e),polyhedron:e=>this.makePolyhedron(e),tetrahedron:e=>this.makeTetrahedron(e),torus:e=>this.makeTorus(e),torusKnot:e=>this.makeTorusKnot(e)}}enableFog(t=0,r=1,i=1e3){return this.scene.fog=new e.Fog(t,r,i),this}enableFogExp2(t=0,r=25e-5){return this.scene.fog=new e.FogExp2(t,r),this}enableGamma(e=!0,t=!0){return this.renderer.gammaInput=e,this.renderer.gammaOutput=t,this}enableShadows(t=e.PCFShadowMap){return this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=t,this}setCubeBackground(...e){return this.scene.background=this.createCubeTexture(...e),this}createCubeTexture(t,r="px.png",i="nx.png",a="py.png",n="ny.png",s="pz.png",o="nz.png"){return"/"!==t.substr(-1)&&(t=t.concat("/")),(new e.CubeTextureLoader).setPath(t).load([r,i,a,n,s,o])}castShadow(...e){for(const t of e.values())t.castShadow=!0;return this}receiveShadow(...e){for(const t of e.values())t.receiveShadow=!0;return this}setShadow(e,t=512,r=512,i=1,a=1e3){return e.castShadow=!0,e.shadow.mapSize.width=t,e.shadow.mapSize.height=r,e.shadow.camera.near=i,e.shadow.camera.far=a,e}addGLTFModel(t,r,i){const a=this.root.cache.binary.get(t);(new e.GLTFLoader).parse(a,r,t=>{const r=new e.Group;for(let e=t.scene.children.length-1;e>-1;e--)r.add(t.scene.children[e]);this.scene.add(r),this.emit("loadgltf",t,r),i&&i(t,r)})}parseGLTFModel(t,r,i){const a=this.root.cache.binary.get(t);(new e.GLTFLoader).parse(a,r,e=>{this.emit("loadgltf",e),i&&i(e)})}getTexture(t){let r=new e.Texture;return r.image=this.root.textures.get(t).getSourceImage(),r.format=e.RGBAFormat,r.needsUpdate=!0,r.anisotropy=this.textureAnisotropy,r}addHemisphereLight({skyColor:t=16777215,groundColor:r=0,intensity:i=1}={}){const a=new e.HemisphereLight(t,r,i);return this.scene.add(a),a}addAmbientLight({color:t=16777215,intensity:r=1}={}){const i=new e.AmbientLight(t,r);return this.scene.add(i),i}addDirectionalLight({color:t=16777215,intensity:r=1,x:i=0,y:a=0,z:n=0}={}){const s=new e.DirectionalLight(t,r);return s.position.set(i,a,n),this.scene.add(s),s}addPointLight({color:t=16777215,intensity:r=1,distance:i=0,decay:a=1,x:n=0,y:s=0,z:o=0}={}){const l=new e.PointLight(t,r,i,a);return l.position.set(n,s,o),this.scene.add(l),l}addSpotLight({color:t=16777215,intensity:r=1,distance:i=0,angle:a=Math.PI/4,penumbra:n=.05,decay:s=1,x:o=0,y:l=0,z:h=0}={}){const c=new e.SpotLight(t,r,i,a,n,s);return c.position.set(o,l,h),this.scene.add(c),c}addGroup(t){const r=new e.Group;if(Array.isArray(t))for(let e=0;e<t.length;e++)r.add(t[e]);return this.scene.add(r),r}addMesh(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.scene.add(e[t]);else this.scene.add(e);return this}createTexture({key:t,wrap:r,wrapS:i=e.ClampToEdgeWrapping,wrapT:a=e.ClampToEdgeWrapping,repeatX:n=2,repeatY:s=2}={}){const o=this.getTexture(t);return r&&(i=r,a=r),o.wrapS=i,o.wrapT=a,o.repeat.set(n,s),o.premultiplyAlpha=!0,o}createMaterial(t,r,i){if(i&&!Phaser.Utils.Objects.IsPlainObject(i))return i;{null===i&&(i={});let a={...i};t&&(a.map="string"==typeof t?this.getTexture(t):t),r&&(a.color=r);const n=a.basic,s=a.phong,o=a.line;return delete a.basic,delete a.phong,delete a.line,n?new e.MeshBasicMaterial(a):s?new e.MeshPhongMaterial(a):o?new e.LineBasicMaterial(a):new e.MeshStandardMaterial(a)}}createMesh(t,r,i=0,a=0,n=0){let s=new e.Mesh(t,r);return s.position.set(i,a,n),s}makeText({text:t="",font:r="",size:i=100,height:a=50,curveSegments:n=12,bevelEnabled:s=!1,bevelThickness:o=10,bevelSize:l=8,bevelSegments:h=3,texture:c=null,color:u=16777215,material:d=null,x:p=0,y:f=0,z:m=0}={}){r=new e.Font(this.root.sys.cache.json.get(r));const g=new e.TextBufferGeometry(t,{font:r,size:i,height:a,curveSegments:n,bevelEnabled:s,bevelThickness:o,bevelSize:l,bevelSegments:h});return this.createMesh(g,this.createMaterial(c,u,d),p,f,m)}addText(e){const t=this.makeText(e);return this.scene.add(t),t}makeCircle({radius:t=1,segments:r=8,thetaStart:i=0,thetaLength:a=2*Math.PI,texture:n=null,color:s=16777215,material:o=null,x:l=0,y:h=0,z:c=0}={}){const u=new e.CircleBufferGeometry(t,r,i,a);return this.createMesh(u,this.createMaterial(n,s,o),l,h,c)}addCircle(e){const t=this.makeCircle(e);return this.scene.add(t),t}makeRing({innerRadius:t=.5,outerRadius:r=1,thetaSegments:i=8,phiSegments:a=1,thetaStart:n=0,thetaLength:s=2*Math.PI,texture:o=null,color:l=16777215,material:h=null,x:c=0,y:u=0,z:d=0}={}){const p=new e.RingBufferGeometry(t,r,i,a,n,s);return this.createMesh(p,this.createMaterial(o,l,h),c,u,d)}addRing(e){const t=this.makeRing(e);return this.scene.add(t),t}makeExtrude({shapes:t,options:r,texture:i=null,color:a=16777215,material:n=null,x:s=0,y:o=0,z:l=0}={}){const h=new e.ExtrudeBufferGeometry(t,r);return this.createMesh(h,this.createMaterial(i,a,n),s,o,l)}addExtrude(e){const t=this.makeExtrude(e);return this.scene.add(t),t}makeShape({shapes:t,curveSegments:r=12,texture:i=null,color:a=16777215,material:n=null,x:s=0,y:o=0,z:l=0}={}){const h=new e.ShapeBufferGeometry(t,r);return this.createMesh(h,this.createMaterial(i,a,n),s,o,l)}addShape(e){const t=this.makeShape(e);return this.scene.add(t),t}makeLathe({points:t,texture:r=null,color:i=16777215,material:a=null,x:n=0,y:s=0,z:o=0}={}){const l=new e.LatheBufferGeometry(t);return this.createMesh(l,this.createMaterial(r,i,a),n,s,o)}addLathe(e){const t=this.makeLathe(e);return this.scene.add(t),t}makeTube({path:t,tubularSegments:r=64,radius:i=1,radialSegments:a=8,closed:n=!1,texture:s=null,color:o=16777215,material:l=null,x:h=0,y:c=0,z:u=0}={}){const d=new e.TubeBufferGeometry(t,r,i,a,n);return this.createMesh(d,this.createMaterial(s,o,l),h,c,u)}addTube(e){const t=this.makeTube(e);return this.scene.add(t),t}makeParametric({func:t,slices:r,stacks:i,texture:a=null,color:n=16777215,material:s=null,x:o=0,y:l=0,z:h=0}={}){const c=new e.ParametricBufferGeometry(t,r,i);return this.createMesh(c,this.createMaterial(a,n,s),o,l,h)}addParametric(e){const t=this.makeParametric(e);return this.scene.add(t),t}makeTorus({radius:t=1,tube:r=.4,radialSegments:i=8,tubularSegments:a=6,arc:n=2*Math.PI,texture:s=null,color:o=16777215,material:l=null,x:h=0,y:c=0,z:u=0}={}){const d=new e.TorusBufferGeometry(t,r,i,a,n);return this.createMesh(d,this.createMaterial(s,o,l),h,c,u)}addTorus(e){const t=this.makeTorus(e);return this.scene.add(t),t}makePolyhedron({vertices:t=[],indices:r=[],radius:i=6,detail:a=2,texture:n=null,color:s=16777215,material:o=null,x:l=0,y:h=0,z:c=0}={}){const u=new e.PolyhedronBufferGeometry(t,r,i,a);return this.createMesh(u,this.createMaterial(n,s,o),l,h,c)}addPolyhedron(e){const t=this.makePolyhedron(e);return this.scene.add(t),t}makeOctahedron({radius:t=1,detail:r=0,texture:i=null,color:a=16777215,material:n=null,x:s=0,y:o=0,z:l=0}={}){const h=new e.OctahedronBufferGeometry(t,r);return this.createMesh(h,this.createMaterial(i,a,n),s,o,l)}addOctahedron(e){const t=this.makeOctahedron(e);return this.scene.add(t),t}makeIcosahedron({radius:t=1,detail:r=0,texture:i=null,color:a=16777215,material:n=null,x:s=0,y:o=0,z:l=0}={}){const h=new e.IcosahedronBufferGeometry(t,r);return this.createMesh(h,this.createMaterial(i,a,n),s,o,l)}addIcosahedron(e){const t=this.makeIcosahedron(e);return this.scene.add(t),t}makeTetrahedron({radius:t=1,detail:r=0,texture:i=null,color:a=16777215,material:n=null,x:s=0,y:o=0,z:l=0}={}){const h=new e.TetrahedronBufferGeometry(t,r);return this.createMesh(h,this.createMaterial(i,a,n),s,o,l)}addTetrahedron(e){const t=this.makeTetrahedron(e);return this.scene.add(t),t}makeTorusKnot({radius:t=1,tube:r=.4,tubularSegments:i=64,radialSegments:a=8,p:n=2,q:s=3,texture:o=null,color:l=16777215,material:h=null,x:c=0,y:u=0,z:d=0}={}){const p=new e.TorusKnotBufferGeometry(t,r,i,a,n,s);return this.createMesh(p,this.createMaterial(o,l,h),c,u,d)}addTorusKnot(e){const t=this.makeTorusKnot(e);return this.scene.add(t),t}makePlane({width:t=1,height:r=1,widthSegments:i=1,heightSegments:a=1,texture:n=null,color:s=16777215,material:o=null,x:l=0,y:h=0,z:c=0}={}){const u=new e.PlaneBufferGeometry(t,r,i,a);return this.createMesh(u,this.createMaterial(n,s,o),l,h,c)}addPlane(e){const t=this.makePlane(e);return this.scene.add(t),t}addGround({receiveShadow:e=!1,texture:t=null,color:r=16777215,material:i=null}={}){const a=this.makePlane({width:2e3,height:2e3,texture:t,color:r,material:i});return a.rotation.x=.5*-Math.PI,a.receiveShadow=e,this.scene.add(a),a}makeSphere({radius:t=1,widthSegments:r=8,heightSegments:i=6,texture:a=null,color:n=16777215,material:s=null,x:o=0,y:l=0,z:h=0}={}){const c=new e.SphereBufferGeometry(t,r,i);return this.createMesh(c,this.createMaterial(a,n,s),o,l,h)}addSphere(e){const t=this.makeSphere(e);return this.scene.add(t),t}makeCone({radius:t=1,height:r=1,radialSegments:i=8,heightSegments:a=1,openEnded:n=!1,thetaStart:s=0,thetaLength:o=2*Math.PI,texture:l=null,color:h=16777215,material:c=null,x:u=0,y:d=0,z:p=0}={}){const f=new e.ConeBufferGeometry(t,r,i,a,n,s,o);return this.createMesh(f,this.createMaterial(l,h,c),u,d,p)}addCone(e){const t=this.makeCone(e);return this.scene.add(t),t}makeCylinder({radiusTop:t=1,radiusBottom:r=1,height:i=1,radialSegments:a=8,heightSegments:n=1,openEnded:s=!1,thetaStart:o=0,thetaLength:l=2*Math.PI,texture:h=null,color:c=16777215,material:u=null,x:d=0,y:p=0,z:f=0}={}){const m=new e.CylinderBufferGeometry(t,r,i,a,n,s,o,l);return this.createMesh(m,this.createMaterial(h,c,u),d,p,f)}addCylinder(e){const t=this.makeCylinder(e);return this.scene.add(t),t}makeDodecahedron({radius:t=1,detail:r=0,texture:i=null,color:a=16777215,material:n=null,x:s=0,y:o=0,z:l=0}={}){const h=new e.DodecahedronBufferGeometry(t,r);return this.createMesh(h,this.createMaterial(i,a,n),s,o,l)}addDodecahedron(e){const t=this.makeDodecahedron(e);return this.scene.add(t),t}makeBox({size:t=null,width:r=1,height:i=1,depth:a=1,texture:n=null,color:s=16777215,material:o=null,x:l=0,y:h=0,z:c=0}={}){t&&(r=t,i=t,a=t);const u=new e.BoxBufferGeometry(r,i,a);return this.createMesh(u,this.createMaterial(n,s,o),l,h,c)}addBox(e){const t=this.makeBox(e);return this.scene.add(t),t}}}).call(this,r(0))},function(e,t,r){e.exports=r(10)},function(e,t,r){(function(e){e.GLTFLoader=function(){function t(t){this.manager=void 0!==t?t:e.DefaultLoadingManager,this.dracoLoader=null}function r(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}t.prototype={constructor:t,crossOrigin:"anonymous",load:function(t,r,i,a){var n,s=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),s.manager.itemStart(t);var o=function(e){a?a(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},l=new e.FileLoader(s.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.load(t,function(e){try{s.parse(e,n,function(e){r(e),s.manager.itemEnd(t)},o)}catch(e){o(e)}},i,o)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(t,r,l,h){var f,m={};if("string"==typeof t)f=t;else if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===o){try{m[i.KHR_BINARY_GLTF]=new c(t)}catch(e){return void(h&&h(e))}f=m[i.KHR_BINARY_GLTF].content}else f=e.LoaderUtils.decodeText(new Uint8Array(t));var g=JSON.parse(f);if(void 0===g.asset||g.asset.version[0]<2)h&&h(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(g.extensionsUsed)for(var v=0;v<g.extensionsUsed.length;++v){var y=g.extensionsUsed[v],b=g.extensionsRequired||[];switch(y){case i.KHR_LIGHTS_PUNCTUAL:m[y]=new n(g);break;case i.KHR_MATERIALS_UNLIT:m[y]=new s(g);break;case i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[y]=new p(g);break;case i.KHR_DRACO_MESH_COMPRESSION:m[y]=new u(g,this.dracoLoader);break;case i.MSFT_TEXTURE_DDS:m[i.MSFT_TEXTURE_DDS]=new a;break;case i.KHR_TEXTURE_TRANSFORM:m[i.KHR_TEXTURE_TRANSFORM]=new d(g);break;default:b.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}new j(g,m,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(l,h)}}};var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function a(){if(!e.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=i.MSFT_TEXTURE_DDS,this.ddsLoader=new e.DDSLoader}function n(e){this.name=i.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[i.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function s(e){this.name=i.KHR_MATERIALS_UNLIT}n.prototype.loadLight=function(t){var r,i=this.lightDefs[t],a=new e.Color(16777215);void 0!==i.color&&a.fromArray(i.color);var n=void 0!==i.range?i.range:0;switch(i.type){case"directional":(r=new e.DirectionalLight(a)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new e.PointLight(a)).distance=n;break;case"spot":(r=new e.SpotLight(a)).distance=n,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,r.angle=i.spot.outerConeAngle,r.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return r.position.set(0,0,0),r.decay=2,void 0!==i.intensity&&(r.intensity=i.intensity),r.name=i.name||"light_"+t,Promise.resolve(r)},s.prototype.getMaterialType=function(t){return e.MeshBasicMaterial},s.prototype.extendParams=function(t,r,i){var a=[];t.color=new e.Color(1,1,1),t.opacity=1;var n=r.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var s=n.baseColorFactor;t.color.fromArray(s),t.opacity=s[3]}void 0!==n.baseColorTexture&&a.push(i.assignTexture(t,"map",n.baseColorTexture))}return Promise.all(a)};var o="glTF",l=12,h={JSON:1313821514,BIN:5130562};function c(t){this.name=i.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(t,0,l);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var a=new DataView(t,l),n=0;n<a.byteLength;){var s=a.getUint32(n,!0);n+=4;var c=a.getUint32(n,!0);if(n+=4,c===h.JSON){var u=new Uint8Array(t,l+n,s);this.content=e.LoaderUtils.decodeText(u)}else if(c===h.BIN){var d=l+n;this.body=t.slice(d,d+s)}n+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function u(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=i.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t}function d(e){this.name=i.KHR_TEXTURE_TRANSFORM}function p(){return{name:i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return e.ShaderMaterial},extendParams:function(t,r,i){var a=r.extensions[this.name],n=e.ShaderLib.standard,s=e.UniformsUtils.clone(n.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),l=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),h=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),d=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",l).replace("#include <roughnessmap_fragment>",h).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",u);delete s.roughness,delete s.metalness,delete s.roughnessMap,delete s.metalnessMap,s.specular={value:(new e.Color).setHex(1118481)},s.glossiness={value:.5},s.specularMap={value:null},s.glossinessMap={value:null},t.vertexShader=n.vertexShader,t.fragmentShader=d,t.uniforms=s,t.defines={STANDARD:""},t.color=new e.Color(1,1,1),t.opacity=1;var p=[];if(Array.isArray(a.diffuseFactor)){var f=a.diffuseFactor;t.color.fromArray(f),t.opacity=f[3]}if(void 0!==a.diffuseTexture&&p.push(i.assignTexture(t,"map",a.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(a.specularFactor)&&t.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var m=a.specularGlossinessTexture;p.push(i.assignTexture(t,"glossinessMap",m)),p.push(i.assignTexture(t,"specularMap",m))}return Promise.all(p)},createMaterial:function(t){var r=new e.ShaderMaterial({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return r.isGLTFSpecularGlossinessMaterial=!0,r.color=t.color,r.map=void 0===t.map?null:t.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===t.aoMap?null:t.aoMap,r.aoMapIntensity=1,r.emissive=t.emissive,r.emissiveIntensity=1,r.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,r.bumpMap=void 0===t.bumpMap?null:t.bumpMap,r.bumpScale=1,r.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(r.normalScale=t.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===t.specularMap?null:t.specularMap,r.specular=t.specular,r.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,r.glossiness=t.glossiness,r.alphaMap=null,r.envMap=void 0===t.envMap?null:t.envMap,r.envMapIntensity=1,r.refractionRatio=.98,r.extensions.derivatives=!0,r},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,i=0,a=r.length;i<a;i++)t[r[i]]=e[r[i]];return t},refreshUniforms:function(e,t,r,i,a,n){if(!0===a.isGLTFSpecularGlossinessMaterial){var s,o=a.uniforms,l=a.defines;o.opacity.value=a.opacity,o.diffuse.value.copy(a.color),o.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity),o.map.value=a.map,o.specularMap.value=a.specularMap,o.alphaMap.value=a.alphaMap,o.lightMap.value=a.lightMap,o.lightMapIntensity.value=a.lightMapIntensity,o.aoMap.value=a.aoMap,o.aoMapIntensity.value=a.aoMapIntensity,a.map?s=a.map:a.specularMap?s=a.specularMap:a.displacementMap?s=a.displacementMap:a.normalMap?s=a.normalMap:a.bumpMap?s=a.bumpMap:a.glossinessMap?s=a.glossinessMap:a.alphaMap?s=a.alphaMap:a.emissiveMap&&(s=a.emissiveMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),o.uvTransform.value.copy(s.matrix)),a.envMap&&(o.envMap.value=a.envMap,o.envMapIntensity.value=a.envMapIntensity,o.flipEnvMap.value=a.envMap.isCubeTexture?-1:1,o.reflectivity.value=a.reflectivity,o.refractionRatio.value=a.refractionRatio,o.maxMipLevel.value=e.properties.get(a.envMap).__maxMipLevel),o.specular.value.copy(a.specular),o.glossiness.value=a.glossiness,o.glossinessMap.value=a.glossinessMap,o.emissiveMap.value=a.emissiveMap,o.bumpMap.value=a.bumpMap,o.normalMap.value=a.normalMap,o.displacementMap.value=a.displacementMap,o.displacementScale.value=a.displacementScale,o.displacementBias.value=a.displacementBias,null!==o.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}function f(t,r,i,a){e.Interpolant.call(this,t,r,i,a)}u.prototype.decodePrimitive=function(e,t){var r=this.json,i=this.dracoLoader,a=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,s={},o={},l={};for(var h in n){var c=L[h]||h.toLowerCase();s[c]=n[h]}for(h in e.attributes){c=L[h]||h.toLowerCase();if(void 0!==n[h]){var u=r.accessors[e.attributes[h]],d=T[u.componentType];l[c]=d,o[c]=!0===u.normalized}}return t.getDependency("bufferView",a).then(function(e){return new Promise(function(t){i.decodeDracoFile(e,function(e){for(var r in e.attributes){var i=e.attributes[r],a=o[r];void 0!==a&&(i.normalized=a)}t(e)},s,l)})})},d.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},f.prototype=Object.create(e.Interpolant.prototype),f.prototype.constructor=f,f.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,a=e*i*3+i,n=0;n!==i;n++)t[n]=r[a+n];return t},f.prototype.beforeStart_=f.prototype.copySampleValue_,f.prototype.afterEnd_=f.prototype.copySampleValue_,f.prototype.interpolate_=function(e,t,r,i){for(var a=this.resultBuffer,n=this.sampleValues,s=this.valueSize,o=2*s,l=3*s,h=i-t,c=(r-t)/h,u=c*c,d=u*c,p=e*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+c,b=0;b!==s;b++){var S=n[f+b+s],M=n[f+b+o]*h,w=n[p+b+s],T=n[p+b]*h;a[b]=v*S+y*M+m*w+g*T}return a};var m,g=0,v=1,y=2,b=3,S=4,M=5,w=6,T=(Number,e.Matrix3,e.Matrix4,e.Vector2,e.Vector3,e.Vector4,e.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),x={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipMapNearestFilter,9985:e.LinearMipMapNearestFilter,9986:e.NearestMipMapLinearFilter,9987:e.LinearMipMapLinearFilter},P={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},R=(e.BackSide,e.FrontSide,e.NeverDepth,e.LessDepth,e.EqualDepth,e.LessEqualDepth,e.GreaterEqualDepth,e.NotEqualDepth,e.GreaterEqualDepth,e.AlwaysDepth,e.AddEquation,e.SubtractEquation,e.ReverseSubtractEquation,e.ZeroFactor,e.OneFactor,e.SrcColorFactor,e.OneMinusSrcColorFactor,e.SrcAlphaFactor,e.OneMinusSrcAlphaFactor,e.DstAlphaFactor,e.OneMinusDstAlphaFactor,e.DstColorFactor,e.OneMinusDstColorFactor,e.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),L={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},E={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},k={CUBICSPLINE:void 0,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},O="OPAQUE",_="MASK",A="BLEND",C={"image/png":e.RGBAFormat,"image/jpeg":e.RGBFormat};function D(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function G(e,t,r){for(var i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function I(e,t){void 0!==t.extras&&("object"==typeof t.extras?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function B(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var a=t.extras.targetNames;if(e.morphTargetInfluences.length===a.length){e.morphTargetDictionary={};for(r=0,i=a.length;r<i;r++)e.morphTargetDictionary[a[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function F(e){for(var t="",r=Object.keys(e).sort(),i=0,a=r.length;i<a;i++)t+=r[i]+":"+e[r[i]]+";";return t}function U(t){if(t.isInterleavedBufferAttribute){for(var r=t.count,i=t.itemSize,a=t.array.slice(0,r*i),n=0,s=0;n<r;++n)a[s++]=t.getX(n),i>=2&&(a[s++]=t.getY(n)),i>=3&&(a[s++]=t.getZ(n)),i>=4&&(a[s++]=t.getW(n));return new e.BufferAttribute(a,i,t.normalized)}return t.clone()}function j(t,i,a){this.json=t||{},this.extensions=i||{},this.options=a||{},this.cache=new r,this.primitiveCache={},this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function H(e,t,r){var i=t.attributes,a=[];function n(t,i){return r.getDependency("accessor",t).then(function(t){e.addAttribute(i,t)})}for(var s in i){var o=L[s]||s.toLowerCase();o in e.attributes||a.push(n(i[s],o))}if(void 0!==t.indices&&!e.index){var l=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});a.push(l)}return I(e,t),Promise.all(a).then(function(){return void 0!==t.targets?function(e,t,r){for(var i=!1,a=!1,n=0,s=t.length;n<s&&(void 0!==(h=t[n]).POSITION&&(i=!0),void 0!==h.NORMAL&&(a=!0),!i||!a);n++);if(!i&&!a)return Promise.resolve(e);var o=[],l=[];for(n=0,s=t.length;n<s;n++){var h=t[n];if(i){var c=void 0!==h.POSITION?r.getDependency("accessor",h.POSITION):e.attributes.position;o.push(c)}a&&(c=void 0!==h.NORMAL?r.getDependency("accessor",h.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(o),Promise.all(l)]).then(function(r){for(var n=r[0],s=r[1],o=0,l=n.length;o<l;o++)e.attributes.position!==n[o]&&(n[o]=U(n[o]));for(o=0,l=s.length;o<l;o++)e.attributes.normal!==s[o]&&(s[o]=U(s[o]));for(o=0,l=t.length;o<l;o++){var h=t[o],c="morphTarget"+o;if(i&&void 0!==h.POSITION){var u=n[o];u.name=c;for(var d=e.attributes.position,p=0,f=u.count;p<f;p++)u.setXYZ(p,u.getX(p)+d.getX(p),u.getY(p)+d.getY(p),u.getZ(p)+d.getZ(p))}if(a&&void 0!==h.NORMAL){var m=s[o];m.name=c;var g=e.attributes.normal;for(p=0,f=m.count;p<f;p++)m.setXYZ(p,m.getX(p)+g.getX(p),m.getY(p)+g.getY(p),m.getZ(p)+g.getZ(p))}}return i&&(e.morphAttributes.position=n),a&&(e.morphAttributes.normal=s),e})}(e,t.targets,r):e})}return j.prototype.parse=function(e,t){var r=this,i=this.json,a=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var n={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:r,userData:{}};G(a,n,i),e(n)}).catch(t)},j.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],i={},a={},n=0,s=t.length;n<s;n++)for(var o=t[n].joints,l=0,h=o.length;l<h;l++)e[o[l]].isBone=!0;for(var c=0,u=e.length;c<u;c++){var d=e[c];void 0!==d.mesh&&(void 0===i[d.mesh]&&(i[d.mesh]=a[d.mesh]=0),i[d.mesh]++,void 0!==d.skin&&(r[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=a},j.prototype.getDependency=function(e,t){var r=e+":"+t,a=this.cache.get(r);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this.loadNode(t);break;case"mesh":a=this.loadMesh(t);break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this.loadBufferView(t);break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this.loadMaterial(t);break;case"texture":a=this.loadTexture(t);break;case"skin":a=this.loadSkin(t);break;case"animation":a=this.loadAnimation(t);break;case"camera":a=this.loadCamera(t);break;case"light":a=this.extensions[i.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,a)}return a},j.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t},j.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[i.KHR_BINARY_GLTF].body);var a=this.options;return new Promise(function(e,i){r.load(D(t.uri,a.path),e,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},j.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})},j.prototype.loadAccessor=function(t){var r=this,i=this.json,a=this.json.accessors[t];if(void 0===a.bufferView&&void 0===a.sparse)return Promise.resolve(null);var n=[];return void 0!==a.bufferView?n.push(this.getDependency("bufferView",a.bufferView)):n.push(null),void 0!==a.sparse&&(n.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(n).then(function(t){var n,s,o=t[0],l=R[a.type],h=T[a.componentType],c=h.BYTES_PER_ELEMENT,u=c*l,d=a.byteOffset||0,p=void 0!==a.bufferView?i.bufferViews[a.bufferView].byteStride:void 0,f=!0===a.normalized;if(p&&p!==u){var m="InterleavedBuffer:"+a.bufferView+":"+a.componentType,g=r.cache.get(m);g||(n=new h(o),g=new e.InterleavedBuffer(n,p/c),r.cache.add(m,g)),s=new e.InterleavedBufferAttribute(g,l,d/c,f)}else n=null===o?new h(a.count*l):new h(o,d,a.count*l),s=new e.BufferAttribute(n,l,f);if(void 0!==a.sparse){var v=R.SCALAR,y=T[a.sparse.indices.componentType],b=a.sparse.indices.byteOffset||0,S=a.sparse.values.byteOffset||0,M=new y(t[1],b,a.sparse.count*v),w=new h(t[2],S,a.sparse.count*l);null!==o&&s.setArray(s.array.slice());for(var x=0,P=M.length;x<P;x++){var L=M[x];if(s.setX(L,w[x*l]),l>=2&&s.setY(L,w[x*l+1]),l>=3&&s.setZ(L,w[x*l+2]),l>=4&&s.setW(L,w[x*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return s})},j.prototype.loadTexture=function(t){var r,a=this,n=this.json,s=this.options,o=this.textureLoader,l=window.URL||window.webkitURL,h=n.textures[t],c=h.extensions||{},u=(r=c[i.MSFT_TEXTURE_DDS]?n.images[c[i.MSFT_TEXTURE_DDS].source]:n.images[h.source]).uri,d=!1;return void 0!==r.bufferView&&(u=a.getDependency("bufferView",r.bufferView).then(function(e){d=!0;var t=new Blob([e],{type:r.mimeType});return u=l.createObjectURL(t)})),Promise.resolve(u).then(function(t){var r=e.Loader.Handlers.get(t);return r||(r=c[i.MSFT_TEXTURE_DDS]?a.extensions[i.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise(function(e,i){r.load(D(t,s.path),e,void 0,i)})}).then(function(t){!0===d&&l.revokeObjectURL(u),t.flipY=!1,void 0!==h.name&&(t.name=h.name),r.mimeType in C&&(t.format=C[r.mimeType]);var i=(n.samplers||{})[h.sampler]||{};return t.magFilter=x[i.magFilter]||e.LinearFilter,t.minFilter=x[i.minFilter]||e.LinearMipMapLinearFilter,t.wrapS=P[i.wrapS]||e.RepeatWrapping,t.wrapT=P[i.wrapT]||e.RepeatWrapping,t})},j.prototype.assignTexture=function(t,r,a){var n=this;return this.getDependency("texture",a.index).then(function(s){switch(r){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":s.format=e.RGBFormat}if(n.extensions[i.KHR_TEXTURE_TRANSFORM]){var o=void 0!==a.extensions?a.extensions[i.KHR_TEXTURE_TRANSFORM]:void 0;o&&(s=n.extensions[i.KHR_TEXTURE_TRANSFORM].extendTexture(s,o))}t[r]=s})},j.prototype.assignFinalMaterial=function(t){var r=t.geometry,a=t.material,n=this.extensions,s=void 0!==r.attributes.tangent,o=void 0!==r.attributes.color,l=void 0===r.attributes.normal,h=!0===t.isSkinnedMesh,c=Object.keys(r.morphAttributes).length>0,u=c&&void 0!==r.morphAttributes.normal;if(t.isPoints){var d="PointsMaterial:"+a.uuid,p=this.cache.get(d);p||(p=new e.PointsMaterial,e.Material.prototype.copy.call(p,a),p.color.copy(a.color),p.map=a.map,p.lights=!1,this.cache.add(d,p)),a=p}else if(t.isLine){d="LineBasicMaterial:"+a.uuid;var f=this.cache.get(d);f||(f=new e.LineBasicMaterial,e.Material.prototype.copy.call(f,a),f.color.copy(a.color),f.lights=!1,this.cache.add(d,f)),a=f}if(s||o||l||h||c){d="ClonedMaterial:"+a.uuid+":";a.isGLTFSpecularGlossinessMaterial&&(d+="specular-glossiness:"),h&&(d+="skinning:"),s&&(d+="vertex-tangents:"),o&&(d+="vertex-colors:"),l&&(d+="flat-shading:"),c&&(d+="morph-targets:"),u&&(d+="morph-normals:");var m=this.cache.get(d);m||(m=a.isGLTFSpecularGlossinessMaterial?n[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(a):a.clone(),h&&(m.skinning=!0),s&&(m.vertexTangents=!0),o&&(m.vertexColors=e.VertexColors),l&&(m.flatShading=!0),c&&(m.morphTargets=!0),u&&(m.morphNormals=!0),this.cache.add(d,m)),a=m}a.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),r.addAttribute("uv2",new e.BufferAttribute(r.attributes.uv.array,2))),a.isGLTFSpecularGlossinessMaterial&&(t.onBeforeRender=n[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),t.material=a},j.prototype.loadMaterial=function(t){var r,a=this.json,n=this.extensions,s=a.materials[t],o={},l=s.extensions||{},h=[];if(l[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=n[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=c.getMaterialType(s),h.push(c.extendParams(o,s,this))}else if(l[i.KHR_MATERIALS_UNLIT]){var u=n[i.KHR_MATERIALS_UNLIT];r=u.getMaterialType(s),h.push(u.extendParams(o,s,this))}else{r=e.MeshStandardMaterial;var d=s.pbrMetallicRoughness||{};if(o.color=new e.Color(1,1,1),o.opacity=1,Array.isArray(d.baseColorFactor)){var p=d.baseColorFactor;o.color.fromArray(p),o.opacity=p[3]}void 0!==d.baseColorTexture&&h.push(this.assignTexture(o,"map",d.baseColorTexture)),o.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,o.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(h.push(this.assignTexture(o,"metalnessMap",d.metallicRoughnessTexture)),h.push(this.assignTexture(o,"roughnessMap",d.metallicRoughnessTexture)))}!0===s.doubleSided&&(o.side=e.DoubleSide);var f=s.alphaMode||O;return f===A?o.transparent=!0:(o.transparent=!1,f===_&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==e.MeshBasicMaterial&&(h.push(this.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new e.Vector2(1,1),void 0!==s.normalTexture.scale&&o.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&r!==e.MeshBasicMaterial&&(h.push(this.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==e.MeshBasicMaterial&&(o.emissive=(new e.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&r!==e.MeshBasicMaterial&&h.push(this.assignTexture(o,"emissiveMap",s.emissiveTexture)),Promise.all(h).then(function(){var t;return t=r===e.ShaderMaterial?n[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new r(o),void 0!==s.name&&(t.name=s.name),t.map&&(t.map.encoding=e.sRGBEncoding),t.emissiveMap&&(t.emissiveMap.encoding=e.sRGBEncoding),t.specularMap&&(t.specularMap.encoding=e.sRGBEncoding),I(t,s),s.extensions&&G(n,t,s),t})},j.prototype.loadGeometries=function(t){var r=this,a=this.extensions,n=this.primitiveCache;function s(e){return a[i.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then(function(t){return H(t,e,r)})}for(var o,l,h=[],c=0,u=t.length;c<u;c++){var d,p=t[c],f=(l=void 0,(l=(o=p).extensions&&o.extensions[i.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+F(l.attributes):o.indices+":"+F(o.attributes)+":"+o.mode),m=n[f];if(m)h.push(m.promise);else d=p.extensions&&p.extensions[i.KHR_DRACO_MESH_COMPRESSION]?s(p):H(new e.BufferGeometry,p,r),n[f]={primitive:p,promise:d},h.push(d)}return Promise.all(h)},j.prototype.loadMesh=function(t){for(var r=this,i=this.json,a=(this.extensions,i.meshes[t]),n=a.primitives,s=[],o=0,l=n.length;o<l;o++){var h=void 0===n[o].material?m=m||new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide}):this.getDependency("material",n[o].material);s.push(h)}return Promise.all(s).then(function(i){return r.loadGeometries(n).then(function(s){for(var o=[],l=0,h=s.length;l<h;l++){var c,u=s[l],d=n[l],p=i[l];if(d.mode===S||d.mode===M||d.mode===w||void 0===d.mode)!0===(c=!0===a.isSkinnedMesh?new e.SkinnedMesh(u,p):new e.Mesh(u,p)).isSkinnedMesh&&c.normalizeSkinWeights(),d.mode===M?c.drawMode=e.TriangleStripDrawMode:d.mode===w&&(c.drawMode=e.TriangleFanDrawMode);else if(d.mode===v)c=new e.LineSegments(u,p);else if(d.mode===b)c=new e.Line(u,p);else if(d.mode===y)c=new e.LineLoop(u,p);else{if(d.mode!==g)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);c=new e.Points(u,p)}Object.keys(c.geometry.morphAttributes).length>0&&B(c,a),c.name=a.name||"mesh_"+t,s.length>1&&(c.name+="_"+l),I(c,a),r.assignFinalMaterial(c),o.push(c)}if(1===o.length)return o[0];var f=new e.Group;for(l=0,h=o.length;l<h;l++)f.add(o[l]);return f})})},j.prototype.loadCamera=function(t){var r,i=this.json.cameras[t],a=i[i.type];if(a)return"perspective"===i.type?r=new e.PerspectiveCamera(e.Math.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===i.type&&(r=new e.OrthographicCamera(a.xmag/-2,a.xmag/2,a.ymag/2,a.ymag/-2,a.znear,a.zfar)),void 0!==i.name&&(r.name=i.name),I(r,i),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")},j.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return r.inverseBindMatrices=e,r})},j.prototype.loadAnimation=function(t){for(var r=this.json.animations[t],i=[],a=[],n=[],s=[],o=[],l=0,h=r.channels.length;l<h;l++){var c=r.channels[l],u=r.samplers[c.sampler],d=c.target,p=void 0!==d.node?d.node:d.id,m=void 0!==r.parameters?r.parameters[u.input]:u.input,g=void 0!==r.parameters?r.parameters[u.output]:u.output;i.push(this.getDependency("node",p)),a.push(this.getDependency("accessor",m)),n.push(this.getDependency("accessor",g)),s.push(u),o.push(d)}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(n),Promise.all(s),Promise.all(o)]).then(function(i){for(var a=i[0],n=i[1],s=i[2],o=i[3],l=i[4],h=[],c=0,u=a.length;c<u;c++){var d=a[c],p=n[c],m=s[c],g=o[c],v=l[c];if(void 0!==d){var y;switch(d.updateMatrix(),d.matrixAutoUpdate=!0,E[v.path]){case E.weights:y=e.NumberKeyframeTrack;break;case E.rotation:y=e.QuaternionKeyframeTrack;break;case E.position:case E.scale:default:y=e.VectorKeyframeTrack}var b=d.name?d.name:d.uuid,S=void 0!==g.interpolation?k[g.interpolation]:e.InterpolateLinear,M=[];E[v.path]===E.weights?d.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&M.push(e.name?e.name:e.uuid)}):M.push(b);for(var w=0,T=M.length;w<T;w++){var x=new y(M[w]+"."+E[v.path],p.array,m.array,S);"CUBICSPLINE"===g.interpolation&&(x.createInterpolant=function(e){return new f(this.times,this.values,this.getValueSize()/3,e)},x.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),h.push(x)}}}var P=void 0!==r.name?r.name:"animation_"+t;return new e.AnimationClip(P,void 0,h)})},j.prototype.loadNode=function(t){var r=this.json,a=this.extensions,n=this,s=r.meshReferences,o=r.meshUses,l=r.nodes[t];return(!0===l.isBone?Promise.resolve(new e.Bone):void 0!==l.mesh?n.getDependency("mesh",l.mesh).then(function(e){var t;if(s[l.mesh]>1){var r=o[l.mesh]++;(t=e.clone()).name+="_instance_"+r,t.onBeforeRender=e.onBeforeRender;for(var i=0,a=t.children.length;i<a;i++)t.children[i].name+="_instance_"+r,t.children[i].onBeforeRender=e.children[i].onBeforeRender}else t=e;return void 0!==l.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,r=l.weights.length;t<r;t++)e.morphTargetInfluences[t]=l.weights[t]}),t}):void 0!==l.camera?n.getDependency("camera",l.camera):l.extensions&&l.extensions[i.KHR_LIGHTS_PUNCTUAL]&&void 0!==l.extensions[i.KHR_LIGHTS_PUNCTUAL].light?n.getDependency("light",l.extensions[i.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new e.Object3D)).then(function(t){if(void 0!==l.name&&(t.name=e.PropertyBinding.sanitizeNodeName(l.name)),I(t,l),l.extensions&&G(a,t,l),void 0!==l.matrix){var r=new e.Matrix4;r.fromArray(l.matrix),t.applyMatrix(r)}else void 0!==l.translation&&t.position.fromArray(l.translation),void 0!==l.rotation&&t.quaternion.fromArray(l.rotation),void 0!==l.scale&&t.scale.fromArray(l.scale);return t})},j.prototype.loadScene=function(){function t(r,i,a,n){var s=a.nodes[r];return n.getDependency("node",r).then(function(t){return void 0===s.skin?t:n.getDependency("skin",s.skin).then(function(e){for(var t=[],i=0,a=(r=e).joints.length;i<a;i++)t.push(n.getDependency("node",r.joints[i]));return Promise.all(t)}).then(function(i){for(var a=!0===t.isGroup?t.children:[t],n=0,s=a.length;n<s;n++){for(var o=a[n],l=[],h=[],c=0,u=i.length;c<u;c++){var d=i[c];if(d){l.push(d);var p=new e.Matrix4;void 0!==r.inverseBindMatrices&&p.fromArray(r.inverseBindMatrices.array,16*c),h.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[c])}o.bind(new e.Skeleton(l,h),o.matrixWorld)}return t});var r}).then(function(e){i.add(e);var r=[];if(s.children)for(var o=s.children,l=0,h=o.length;l<h;l++){var c=o[l];r.push(t(c,e,a,n))}return Promise.all(r)})}return function(r){var i=this.json,a=this.extensions,n=this.json.scenes[r],s=new e.Scene;void 0!==n.name&&(s.name=n.name),I(s,n),n.extensions&&G(a,s,n);for(var o=n.nodes||[],l=[],h=0,c=o.length;h<c;h++)l.push(t(o[h],s,i,this));return Promise.all(l).then(function(){return s})}}(),t}()}).call(this,r(0))},,,,,function(e,t,r){},,function(e,t,r){"use strict";r.r(t);r(3),r(4),r(7),r(8);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(e,r){var a,o,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,a=!(l=n(t).call(this,e))||"object"!==i(l)&&"function"!=typeof l?s(o):l,function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(s(a),"game",void 0),a}var r,l,h;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,Phaser.Scene),r=t,(l=[{key:"preload",value:function(){}},{key:"setTimerEvent",value:function(e,t,r,i){return this.time.delayedCall(Phaser.Math.Between(e,t),r,i||[],this)}}])&&a(r.prototype,l),h&&a(r,h),t}();function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,d(t).call(this,"BootScene"))}var r,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,l),r=t,(i=[{key:"preload",value:function(){this.load.bitmapFont("retro","./assets/cosmicavenger.png","./assets/cosmicavenger.xml")}},{key:"create",value:function(){this.registry.set("speed",0),this.registry.set("racetime",0),this.registry.set("trackposition",0),this.registry.set("raceposition",0),this.registry.set("playerx",0),this.scene.start("LoadScene",{})}}])&&c(r.prototype,i),a&&c(r,a),t}(),m={type:Phaser.AUTO,scale:{parent:"game-container",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:320,height:180},render:{pixelArt:!0},plugins:{global:[]}};function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var M=function(e){function t(e,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y(this,b(t).call(this,"LoadScene"))}var r,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,l),r=t,(i=[{key:"preload",value:function(){var e=this,t=this.add.graphics();this.load.on("progress",function(r){t.clear(),t.fillStyle(16777215,1),t.fillRect(0,e.scale.gameSize.height/2,e.scale.gameSize.width*r,60)}),this.load.on("complete",function(){t.destroy()}),this.load.image("clouds1","./assets/clouds.png"),this.load.image("clouds2","./assets/clouds2.png"),this.load.image("mountain","./assets/mountain.png"),this.load.image("hills","./assets/hills.png"),this.load.image("boulder1","./assets/boulder.png"),this.load.image("boulder2","./assets/boulder2.png"),this.load.image("tree1","./assets/tree.png"),this.load.image("tree2","./assets/tree2.png"),this.load.image("tree3","./assets/tree3.png"),this.load.image("turnsign","./assets/turn-sign.png"),this.load.spritesheet("particles","./assets/smoke-particle.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("car-green","./assets/car-green.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("car-army","./assets/car-army.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("car-red","./assets/car-red.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("car-yellow","./assets/car-yellow.png",{frameWidth:64,frameHeight:64}),this.load.binary("playercar","./assets/3d/car.glb")}},{key:"create",value:function(){this.scene.start("GameScene",{})}}])&&v(r.prototype,i),a&&v(r,a),t}(),w={ROAD_LIGHT:new Phaser.Display.Color(127,127,127,1),ROAD_DARK:new Phaser.Display.Color(123,123,123,1),GRASS_LIGHT:new Phaser.Display.Color(118,197,120,1),GRASS_DARK:new Phaser.Display.Color(130,211,34,1),LANE_MARKER:new Phaser.Display.Color(220,220,220,1),RUMBLE_LIGHT:new Phaser.Display.Color(200,200,200,1),RUMBLE_DARK:new Phaser.Display.Color(177,64,64,1),SKY:new Phaser.Display.Color(127,127,255,1)},T={ROAD:w.ROAD_DARK.color,GRASS:w.GRASS_DARK.color,RUMBLE:w.RUMBLE_LIGHT.color},x={ROAD:w.ROAD_LIGHT.color,GRASS:w.GRASS_LIGHT.color,RUMBLE:w.RUMBLE_DARK.color,LANE:w.LANE_MARKER.color};function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var R=new function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,"roadWidth",2200),P(this,"roadWidthClamp",3),P(this,"segmentLength",200),P(this,"rumbleLength",6),P(this,"lanes",3),P(this,"fieldOfView",110),P(this,"cameraHeight",2e3),P(this,"cameraDepth",1/Math.tan(this.fieldOfView/2*Math.PI/180)),P(this,"projectYCompensation",30),P(this,"drawDistance",500),P(this,"fogDensity",5),P(this,"maxSpeed",8*this.segmentLength),P(this,"accel",this.maxSpeed/50),P(this,"decel",-this.maxSpeed/70),P(this,"breaking",-this.maxSpeed/20),P(this,"offRoadDecel",-this.maxSpeed/10),P(this,"offRoadLimit",this.maxSpeed/4),P(this,"centrifugal",.175),P(this,"steerCompensation",.5),P(this,"maxTurn",1),P(this,"turnResetMultiplier",.1),P(this,"cameraAngleResetMultiplier",.07),P(this,"totalCars",30)};function L(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,i;return t=e,i=[{key:"rumbleWidth",value:function(e,t){return e/Math.max(6,2*t)}},{key:"laneMarkerWidth",value:function(e,t){return e/Math.max(32,8*t)}},{key:"increase",value:function(e,t,r){for(var i=e+t;i>=r;)i-=r;for(;i<0;)i+=r;return i}},{key:"accelerate",value:function(e,t,r){return e+t*r}},{key:"interpolate",value:function(e,t,r){return e+(t-e)*r}},{key:"easeIn",value:function(e,t,r){return e+(t-e)*Math.pow(r,2)}},{key:"easeOut",value:function(e,t,r){return e+(t-e)*(1-Math.pow(1-r,2))}},{key:"easeInOut",value:function(e,t,r){return e+(t-e)*(-Math.cos(r*Math.PI)/2+.5)}},{key:"percentRemaining",value:function(e,t){return e%t/t}},{key:"toInt",value:function(t,r){if(null!==t){var i=parseInt(t,10);if(!isNaN(i))return i}return e.toInt(r,0)}},{key:"overlapPlayer",value:function(e,t){var r=e.scene.scale.gameSize.width/2,i=new Phaser.Geom.Rectangle;return t.sprite.getBounds(i).contains(r-e.collisionRadius,150)||t.sprite.getBounds(i).contains(r+e.collisionRadius,150)}},{key:"overlapSprite",value:function(e,t){var r=e.getBounds(),i=t.getBounds();return Phaser.Geom.Rectangle.Overlaps(r,i)}}],(r=null)&&L(t.prototype,r),i&&L(t,i),e}(),k=r(1);function O(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var A=Math.PI/2,C=function(){function e(t,r,i,a,n){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_(this,"position",void 0),_(this,"sprite",void 0),_(this,"scene",void 0),_(this,"p3d",void 0),_(this,"model",void 0),_(this,"smokeParticles",void 0),_(this,"smokeEmitterLeft",void 0),_(this,"smokeEmitterRight",void 0),_(this,"turn",void 0),_(this,"pitch",void 0),_(this,"speed",void 0),_(this,"trackPosition",void 0),_(this,"accelerating",!1),_(this,"collisionRadius",20),_(this,"turnVector",void 0),this.position=new Phaser.Math.Vector3(r,i,a),this.scene=t,this.turn=0,this.pitch=0,this.speed=0,this.trackPosition=0,this.turnVector=new Phaser.Math.Vector3(0,0,0),this.smokeParticles=this.scene.add.particles("particles").setDepth(21);var o={x:-100,y:-100,lifespan:500,frequency:66,frame:0,blendMode:"NORMAL",gravityY:-100,speed:0,rotate:{onEmit:function(){return 359*Math.random()}},scale:{start:.3,end:2}};this.smokeEmitterLeft=this.smokeParticles.createEmitter(o),this.smokeEmitterRight=this.smokeParticles.createEmitter(o),this.p3d=new k.a(this.scene,{fov:35,x:0,y:7,z:-20,antialias:!1}),this.p3d.view.setDepth(20),this.p3d.addGLTFModel(n),this.p3d.camera.lookAt(0,5.1,0),this.p3d.add.hemisphereLight({skyColor:15724543,groundColor:1118481,intensity:2}),this.p3d.on("loadgltf",function(e,t){t.rotateY(A),t.position.set(0,0,0),t.scale.set(1,1,1),s.model=t})}var t,r,i;return t=e,(r=[{key:"update",value:function(e,t){this.position.x+=.08*this.turn*(this.speed/R.maxSpeed),this.model&&(this.turnVector.y=A+-this.turn,this.turnVector.x=Phaser.Math.Clamp(this.pitch,-.3,.3),this.model.rotation.setFromVector3(this.turnVector),this.p3d.camera.rotation.z=Math.PI+Phaser.Math.DegToRad(this.scene.cameraAngle),this.pitch>0&&(this.model.position.y=E.interpolate(this.model.position.y,3*-this.pitch,.33)),this.speed>20&&(this.model.position.y=E.interpolate(this.model.position.y+Phaser.Math.Between(-1,1)*(this.isOnGravel?.05:.01),0,.2)),this.updateParticles())}},{key:"updateParticles",value:function(){var e=100*-this.turn,t=this.turn<0?{min:-30,max:0}:{min:180,max:210},r=this.scene.scale.gameSize.width/2+20*-this.turn;this.smokeEmitterLeft.setPosition(r-13,this.scene.scale.gameSize.height-5-15*this.pitch-(this.turn>0?7*this.turn:0)),this.smokeEmitterRight.setPosition(r+13,this.scene.scale.gameSize.height-5-15*this.pitch+(this.turn<0?7*this.turn:0)),this.smokeEmitterLeft.setSpeed(e),this.smokeEmitterRight.setSpeed(e),this.smokeEmitterLeft.setAngle(t),this.smokeEmitterRight.setAngle(t),this.isOnGravel?(this.smokeEmitterLeft.setFrame(1),this.smokeEmitterRight.setFrame(1)):(this.smokeEmitterLeft.setFrame(0),this.smokeEmitterRight.setFrame(0)),this.speed>300&&Math.abs(this.turn)>.66&&!this.smokeEmitterLeft.on?(this.smokeEmitterLeft.on=!0,this.smokeEmitterRight.on=!0):this.speed>100&&this.isOnGravel?(this.smokeEmitterLeft.on=!0,this.smokeEmitterRight.on=!0):this.speed<500&&this.accelerating?(this.smokeEmitterLeft.on=!0,this.smokeEmitterRight.on=!0):(this.smokeEmitterLeft.stop(),this.smokeEmitterRight.stop())}},{key:"x",get:function(){return this.position.x},set:function(e){this.position.x=e,this.scene.registry.set("playerx",e)}},{key:"y",get:function(){return this.position.y},set:function(e){this.position.y=e}},{key:"z",get:function(){return this.position.z},set:function(e){this.position.z=e}},{key:"isOnGravel",get:function(){return Math.abs(this.x)>1}}])&&O(t.prototype,r),i&&O(t,i),e}();function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var G=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),D(this,"world",void 0),D(this,"camera",void 0),D(this,"screen",void 0),this.world=new Phaser.Math.Vector3(t,r,i),this.camera=new Phaser.Math.Vector3(0,0,0),this.screen={x:0,y:0,w:0,scale:0}};function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var B=function e(t,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),I(this,"index",void 0),I(this,"p1",void 0),I(this,"p2",void 0),I(this,"looped",!1),I(this,"fog",0),I(this,"curve",void 0),I(this,"colors",void 0),I(this,"props",void 0),I(this,"cars",void 0),I(this,"clip",void 0),this.index=t,this.p1=new G(0,a,t*R.segmentLength),this.p2=new G(0,i,(t+1)*R.segmentLength),this.colors=Math.floor(t/R.rumbleLength)%2?T:x,this.curve=r,this.clip=0,this.props=new Set,this.cars=new Set},F={NONE:0,SHORT:25,MEDIUM:50,LONG:100},U={NONE:0,EASY:2,MEDIUM:4,HARD:6},j={NONE:0,LOW:20,MEDIUM:40,HIGH:60};function H(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var z=function(){function e(t,r,i,a){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),N(this,"scene",void 0),N(this,"sprite",void 0),N(this,"offset",void 0),N(this,"height",void 0),N(this,"collides",void 0),N(this,"scale",1),this.scene=t,this.sprite=t.add.sprite(-999,-999,r).setOrigin(.5,1).setVisible(!1),this.offset=i,this.height=a,this.collides=o,this.scale=n,this.sprite.flipX=s}var t,r,i;return t=e,(r=[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.sprite.setPosition(e,t+this.height),this.sprite.setScale(this.scale*r),this.sprite.setDepth(10+r),this.sprite.visible||this.sprite.setVisible(!0),t>i){var a=(t-i)/this.sprite.scaleY,n=this.sprite.height-a;this.sprite.setCrop(0,0,this.sprite.width,n)}else this.sprite.setCrop()}},{key:"destroy",value:function(){this.sprite.destroy(),this.scene=void 0}}])&&H(t.prototype,r),i&&H(t,i),e}();function V(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var W=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),K(this,"scene",void 0),K(this,"segments",void 0),K(this,"trackLength",void 0),this.scene=t,this.segments=[],this.trackLength=0}var t,r,i;return t=e,(r=[{key:"addRoadSegment",value:function(e,t){this.segments.push(new B(this.segments.length,e,t,this.getLastSegmentYPos()))}},{key:"addStraight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.MEDIUM;this.addRoad(e,e,e,0,0)}},{key:"addCurve",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.MEDIUM,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.MEDIUM,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.addRoad(e,e,e,t,r)}},{key:"addHill",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.MEDIUM,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.addRoad(e,e,e,0,t)}},{key:"addRoad",value:function(e,t,r,i,a){for(var n=this.getLastSegmentYPos(),s=n+E.toInt(a,0)*R.segmentLength,o=e+t+r,l=0;l<e;l++)this.addRoadSegment(E.easeIn(0,i,l/e),E.easeInOut(n,s,l/o));for(var h=0;h<t;h++)this.addRoadSegment(i,E.easeInOut(n,s,(e+h)/o));for(var c=0;c<r;c++)this.addRoadSegment(E.easeInOut(i,0,c/r),E.easeInOut(n,s,(e+t+c)/o))}},{key:"getLastSegmentYPos",value:function(){var e=this.getLastSegment();return e?e.p2.world.y:0}},{key:"getLastSegment",value:function(){return this.segments.length>0?this.segments[this.segments.length-1]:null}},{key:"findSegmentByZ",value:function(e){var t=Math.floor(e/R.segmentLength)%this.segments.length;return this.segments[t]}},{key:"resetRoad",value:function(){this.segments=[],this.addStraight(F.LONG),this.addCurve(F.MEDIUM,U.MEDIUM,j.LOW),this.addHill(F.LONG,j.MEDIUM),this.addCurve(F.LONG,U.MEDIUM),this.addHill(F.SHORT,-j.MEDIUM),this.addHill(F.MEDIUM,j.HIGH),this.addStraight(),this.addCurve(F.SHORT,U.MEDIUM,j.LOW),this.addHill(F.LONG,-j.HIGH),this.addCurve(F.LONG,-U.MEDIUM),this.addCurve(F.LONG,U.MEDIUM),this.addStraight(),this.addCurve(F.LONG,-U.EASY),this.addHill(F.LONG,-j.MEDIUM),this.addCurve(F.LONG,U.MEDIUM,-j.LOW),this.addRoad(200,200,200,U.NONE,Math.round(-this.getLastSegmentYPos()/R.segmentLength)),this.trackLength=this.segments.length*R.segmentLength,this.createRandomProps(),this.createTurnSigns()}},{key:"addProp",value:function(e,t,r,i){arguments.length>4&&void 0!==arguments[4]&&arguments[4];var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3e3,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];try{var o=this.segments[t],l=new z(e,r,i,0,a,n,s);return o.props.add(l),!0}catch(e){return!1}}},{key:"hideAllProps",value:function(){this.segments.forEach(function(e){var t=!0,r=!1,i=void 0;try{for(var a,n=e.props[Symbol.iterator]();!(t=(a=n.next()).done);t=!0){a.value.sprite.setVisible(!1)}}catch(e){r=!0,i=e}finally{try{t||null==n.return||n.return()}finally{if(r)throw i}}})}},{key:"createRandomProps",value:function(){for(var e=0;e<this.segments.length;e+=Phaser.Math.Between(1,5)){var t=Phaser.Math.FloatBetween(1.75,10),r=Math.random()-.5>0,i=void 0,a=3e3;switch(Phaser.Math.Between(1,5)){case 1:i="boulder1",a=1500;break;case 2:i="boulder2",a=2e3;break;case 3:i="tree1",a=5e3;break;case 4:i="tree2",a=5500;break;case 5:i="tree3",a=5e3}this.addProp(this.scene,e,i,r?-t:t,0,a,!1)}}},{key:"createTurnSigns",value:function(){for(var e=0;e<this.segments.length;e++){var t=this.segments[e];Math.abs(t.curve)>1&&(t.curve>.33?(this.removeProps(t,1,-1.75),this.addProp(this.scene,e,"turnsign",-1.75,0,5e3,!0,!1)):(this.removeProps(t,1,1.75),this.addProp(this.scene,e,"turnsign",1.75,0,5e3,!1,!1)),e+=10)}}},{key:"removeProps",value:function(e,t,r){var i=r<0,a=this.segments.slice(e.index-t,e.index+t),n=!0,s=!1,o=void 0;try{for(var l,h=a[Symbol.iterator]();!(n=(l=h.next()).done);n=!0){var c=l.value;if(c.props.size){var u=!0,d=!1,p=void 0;try{for(var f,m=c.props[Symbol.iterator]();!(u=(f=m.next()).done);u=!0){var g=f.value;(g.offset<0&&i||g.offset>0&&!i)&&c.props.delete(g)}}catch(e){d=!0,p=e}finally{try{u||null==m.return||m.return()}finally{if(d)throw p}}}}}catch(e){s=!0,o=e}finally{try{n||null==h.return||h.return()}finally{if(s)throw o}}}}])&&V(t.prototype,r),i&&V(t,i),e}();function Y(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function X(e,t,r){return t&&Y(e.prototype,t),r&&Y(e,r),e}function Z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var q=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z(this,"scene",void 0),Z(this,"roadGraphics",void 0),this.scene=t,this.roadGraphics=this.scene.add.graphics().setDepth(r)}return X(e,null,[{key:"project",value:function(e,t,r,i,a,n,s,o){e.camera.x=(e.world.x||0)-t,e.camera.y=(e.world.y||0)-r,e.camera.z=(e.world.z||0)-i,e.screen.scale=a/e.camera.z,e.screen.x=Math.round(n/2+e.screen.scale*e.camera.x*n/2),e.screen.y=Math.round(s/2-e.screen.scale*e.camera.y*s/2),e.screen.w=Math.round(e.screen.scale*o*n/2)}},{key:"drawPolygon",value:function(e,t,r,i,a,n,s,o,l,h){e.save().fillStyle(h).beginPath().moveTo(t,r).lineTo(i,a).lineTo(n,s).lineTo(o,l).closePath().fillPath().restore()}},{key:"drawSegment",value:function(t,r,i,a,n,s,o,l,h,c){var u=E.rumbleWidth(s,i),d=E.rumbleWidth(h,i),p=E.laneMarkerWidth(s,i),f=E.laneMarkerWidth(s,i),m=n-l;t.fillStyle(c.GRASS),t.fillRect(-10,l,r,m),e.drawPolygon(t,a-s-u,n,a-s,n,o-h,l,o-h-d,l,c.RUMBLE),e.drawPolygon(t,a+s+u,n,a+s,n,o+h,l,o+h+d,l,c.RUMBLE),e.drawPolygon(t,a-s,n,a+s,n,o+h,l,o-h,l,c.ROAD);var g=2*s/i,v=2*h/i,y=a-s+g,b=o-h+v;if(c.LANE)for(var S=1;S<i;y+=g,b+=v,S++)e.drawPolygon(t,y-p/2,n,y+p/2,n,b+f/2,l,b-f/2,l,c.LANE)}}]),X(e,[{key:"update",value:function(e,t){this.roadGraphics.clear(),this.drawRoad()}},{key:"drawRoad",value:function(){for(var t=this.scene.scale.gameSize.width+20,r=this.scene.scale.gameSize.height+20,i=this.scene.road.findSegmentByZ(this.scene.player.trackPosition),a=E.percentRemaining(this.scene.player.trackPosition,R.segmentLength),n=r,s=0,o=-i.curve*a,l=0;l<R.drawDistance;l++){var h=(i.index+l)%this.scene.road.segments.length,c=this.scene.road.segments[h];c.clip=n,c.looped=c.index<i.index,e.project(c.p1,this.scene.player.x*R.roadWidth-s,this.scene.player.y+R.cameraHeight,this.scene.player.trackPosition-(c.looped?this.scene.road.trackLength:0),R.cameraDepth,t,r-R.projectYCompensation,R.roadWidth),e.project(c.p2,this.scene.player.x*R.roadWidth-s-o,this.scene.player.y+R.cameraHeight,this.scene.player.trackPosition-(c.looped?this.scene.road.trackLength:0),R.cameraDepth,t,r-R.projectYCompensation,R.roadWidth),s+=o,o+=c.curve,c.p1.camera.z<=R.cameraDepth||c.p2.screen.y>=n||c.p2.screen.y>=c.p1.screen.y||(e.drawSegment(this.roadGraphics,t,R.lanes,c.p1.screen.x-10,c.p1.screen.y,c.p1.screen.w,c.p2.screen.x-10,c.p2.screen.y,c.p2.screen.w,c.colors),n=c.p2.screen.y)}for(var u=R.drawDistance;u>0;u--){var d=(i.index+u)%this.scene.road.segments.length,p=this.scene.road.segments[d],f=p.p1.screen.scale,m=!0,g=!1,v=void 0;try{for(var y,b=p.props[Symbol.iterator]();!(m=(y=b.next()).done);m=!0){var S=y.value,M=p.p1.screen.x-10+f*S.offset*R.roadWidth*t/2;S.update(M,p.p1.screen.y,f,p.clip)}}catch(e){g=!0,v=e}finally{try{m||null==b.return||b.return()}finally{if(g)throw v}}var w=!0,T=!1,x=void 0;try{for(var P,L=p.cars[Symbol.iterator]();!(w=(P=L.next()).done);w=!0){var k=P.value,O=E.interpolate(p.p1.screen.scale,p.p2.screen.scale,k.percent),_=E.interpolate(p.p1.screen.x-10,p.p2.screen.x-10,k.percent)+O*k.offset*R.roadWidth*t/2,A=E.interpolate(p.p1.screen.y,p.p2.screen.y,k.percent);k.draw(_,A,O,p.clip)}}catch(e){T=!0,x=e}finally{try{w||null==L.return||L.return()}finally{if(T)throw x}}}}}]),e}();function J(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $=function(){function e(t,r,i,a,n,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Q(this,"scene",void 0),Q(this,"road",void 0),Q(this,"sprite",void 0),Q(this,"offset",0),Q(this,"speed",0),Q(this,"trackPosition",0),Q(this,"percent",0),Q(this,"scale",1500),this.scene=t,this.road=r,this.offset=i,this.speed=s,this.trackPosition=a,this.sprite=this.scene.add.sprite(-999,999,n,0).setOrigin(.5,1)}var t,r,i;return t=e,(r=[{key:"update",value:function(e,t,r,i){this.updateOffset(e,t,r),this.updateAngleFrame(t,r,i)}},{key:"draw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.sprite.setPosition(e,t),this.sprite.setScale(this.scale*r),this.sprite.setDepth(10+r),this.sprite.visible||this.sprite.setVisible(!0),t>i){var a=(t-i)/this.sprite.scaleY,n=this.sprite.height-a;this.sprite.setCrop(0,0,this.sprite.width,n)}else this.sprite.setCrop()}},{key:"updateAngleFrame",value:function(e,t,r){var i=Math.abs(e.index-t.index),a=Math.abs(r-this.offset),n=r>this.offset;i<20&&a>.3?(this.sprite.setFrame(1),this.sprite.flipX=!n):this.sprite.setFrame(0)}},{key:"updateOffset",value:function(e,t,r){var i=this,a=this.scene.player;if(!(t.index-r.index>R.drawDistance)){for(var n=0;n<50;n++){var s=this.road.segments[(t.index+n)%this.road.segments.length];s===r&&this.speed>a.speed&&E.overlapPlayer(a,this)&&(a.x<this.offset?this.offset=E.interpolate(this.offset,1,.1*e):this.offset=E.interpolate(this.offset,-1,.1*e)),s.cars.size&&s.cars.forEach(function(t){t!==i&&i.speed>t.speed&&E.overlapSprite(t.sprite,i.sprite)&&(t.offset<i.offset?i.offset=E.interpolate(i.offset,1,.1*e):i.offset=E.interpolate(i.offset,-1,.1*e))})}Math.abs(this.offset)>.9&&(this.offset=E.interpolate(this.offset,0,e))}}},{key:"destroy",value:function(){this.sprite.destroy()}},{key:"isOnGravel",get:function(){return Math.abs(this.offset)>1}}])&&J(t.prototype,r),i&&J(t,i),e}();function ee(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var re=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),te(this,"scene",void 0),te(this,"cars",new Set),te(this,"road",void 0),this.scene=t,this.road=r}var t,r,i;return t=e,(r=[{key:"resetCars",value:function(){this.destroy();for(var e=0;e<R.totalCars;e++){var t=Phaser.Math.FloatBetween(-.8,.8),r=Phaser.Math.Between(0,this.road.trackLength),i=this.getRandomCarType(),a=Phaser.Math.Between(.2*R.maxSpeed,.8*R.maxSpeed),n=new $(this.scene,this.road,t,r,i,a),s=this.road.findSegmentByZ(r);this.cars.add(n),s.cars.add(n)}}},{key:"update",value:function(e,t,r){var i=!0,a=!1,n=void 0;try{for(var s,o=this.cars[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value,h=this.road.findSegmentByZ(l.trackPosition);l.update(e,h,t,r),l.trackPosition=E.increase(l.trackPosition,e*l.speed,this.road.trackLength),l.percent=E.percentRemaining(l.trackPosition,R.segmentLength);var c=this.road.findSegmentByZ(l.trackPosition);c.index!==h.index&&(h.cars.delete(l),c.cars.add(l))}}catch(e){a=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw n}}}},{key:"hideAll",value:function(){this.cars.forEach(function(e){e.sprite.setVisible(!1)})}},{key:"destroy",value:function(){this.cars.forEach(function(e){return e.destroy()}),this.cars.clear()}},{key:"getRandomCarType",value:function(){var e=["car-army","car-yellow","car-red","car-green"];return e[Phaser.Math.Between(0,e.length-1)]}}])&&ee(t.prototype,r),i&&ee(t,i),e}();function ie(e){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ae(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var he=function(e){function t(e,r){var i,a,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=!(n=ne(t).call(this,"GameScene"))||"object"!==ie(n)&&"function"!=typeof n?se(a):n,le(se(i),"position",void 0),le(se(i),"player",void 0),le(se(i),"road",void 0),le(se(i),"renderer",void 0),le(se(i),"carManager",void 0),le(se(i),"debugText",void 0),le(se(i),"sky",void 0),le(se(i),"clouds1",void 0),le(se(i),"clouds2",void 0),le(se(i),"clouds3",void 0),le(se(i),"mountains",void 0),le(se(i),"camera",void 0),le(se(i),"cameraAngle",0),le(se(i),"hills",void 0),le(se(i),"hillsBaseY",void 0),le(se(i),"cursors",void 0),i}var r,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(t,l),r=t,(i=[{key:"create",value:function(){this.scene.launch("RaceUiScene",this);var e=this.scale.gameSize.width,t=this.scale.gameSize.height;this.cursors=this.input.keyboard.createCursorKeys(),this.camera=this.cameras.main,this.road=new W(this),this.carManager=new re(this,this.road),this.sky=this.add.rectangle(-10,-20,e+20,t+30,w.SKY.color).setOrigin(0).setZ(0).setDepth(0),this.clouds2=this.add.tileSprite(-10,10,e+20,64,"clouds1").setOrigin(0).setZ(3).setDepth(1),this.clouds3=this.add.tileSprite(-10,20,e+20,64,"clouds2").setOrigin(0).setZ(4).setDepth(2),this.mountains=this.add.tileSprite(-10,t/2-85,e+20,128,"mountain").setOrigin(0).setZ(3).setDepth(3),this.clouds1=this.add.tileSprite(-10,0,e+20,64,"clouds1").setOrigin(0).setZ(2).setDepth(4),this.hillsBaseY=t/2-40,this.hills=this.add.tileSprite(-10,this.hillsBaseY,e+10,64,"hills").setOrigin(0).setZ(5).setDepth(4),this.renderer=new q(this,5),this.player=new C(this,0,t-5,R.cameraHeight*R.cameraDepth,"playercar"),this.debugText=this.add.bitmapText(5,5,"retro","",16).setTint(16711680).setDepth(200),this.road.resetRoad(),this.carManager.resetCars()}},{key:"update",value:function(e,t){var r=.01*t,i=this.road.findSegmentByZ(this.player.trackPosition+this.player.z),a=E.percentRemaining(this.player.trackPosition+this.player.z,R.segmentLength),n=this.player.speed/R.maxSpeed,s=this.player.speed<=0?0:r*n;if(this.handleInput(t,i),this.player.y=E.interpolate(i.p1.world.y,i.p2.world.y,a),this.player.x=this.player.x-s*n*i.curve*R.centrifugal,this.player.speed=Phaser.Math.Clamp(this.player.speed,0,R.maxSpeed),this.player.x=Phaser.Math.Clamp(this.player.x,-R.roadWidthClamp,R.roadWidthClamp),this.player.turn=Phaser.Math.Clamp(this.player.turn,-R.maxTurn,R.maxTurn),this.player.trackPosition=E.increase(this.player.trackPosition,r*this.player.speed,this.road.trackLength),this.player.pitch=.002*(i.p1.world.y-i.p2.world.y),this.player.isOnGravel&&this.player.speed>R.offRoadLimit&&(this.player.speed=E.accelerate(this.player.speed,R.offRoadDecel,r)),i.props.size&&Math.abs(this.player.x)>1){var o=!0,l=!1,h=void 0;try{for(var c,u=i.props[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var d=c.value;E.overlapPlayer(this.player,d)&&(this.player.trackPosition=E.increase(i.p1.world.z,-this.player.z,this.road.trackLength),this.player.speed=this.player.speed>50?50:this.player.speed)}}catch(e){l=!0,h=e}finally{try{o||null==u.return||u.return()}finally{if(l)throw h}}}if(i.cars.size&&Math.abs(this.player.x)<1){var p=!0,f=!1,m=void 0;try{for(var g,v=i.cars[Symbol.iterator]();!(p=(g=v.next()).done);p=!0){var y=g.value;E.overlapPlayer(this.player,y)&&(this.player.trackPosition=E.increase(y.trackPosition,-this.player.z,this.road.trackLength),this.player.speed=this.player.speed/2)}}catch(e){f=!0,m=e}finally{try{p||null==v.return||v.return()}finally{if(f)throw m}}}this.road.hideAllProps(),this.carManager.hideAll(),this.updateBg(s*i.curve),this.renderer.update(e,t),this.carManager.update(r,i,this.player.x),this.player.update(t,s),this.registry.set("speed",this.player.speed/10|0),this.cameraAngle=Phaser.Math.Clamp(this.cameraAngle,-6,6),this.camera.setAngle(this.cameraAngle)}},{key:"getRadarCars",value:function(e){for(var t=[],r=this.road.findSegmentByZ(this.player.trackPosition),i=0;i<e;i++){var a=(r.index+i)%this.road.segments.length,n=this.road.segments[a],s=!0,o=!1,l=void 0;try{for(var h,c=n.cars[Symbol.iterator]();!(s=(h=c.next()).done);s=!0){var u=h.value;t.push(u)}}catch(e){o=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(o)throw l}}}return t}},{key:"updateBg",value:function(e){this.clouds1.tilePositionX+=.05+e*this.clouds1.z,this.clouds2.tilePositionX+=.1+e*this.clouds2.z,this.clouds3.tilePositionX+=.125+e*this.clouds3.z,this.mountains.tilePositionX+=e*this.mountains.z,this.hills.tilePositionX+=e*this.hills.z,this.hills.setY(this.hillsBaseY-20*this.player.pitch)}},{key:"handleInput",value:function(e,t){var r=.01*e;this.cursors.up.isDown?(this.player.speed=E.accelerate(this.player.speed,R.accel,r),this.player.accelerating=!0):this.cursors.down.isDown?this.player.speed=E.accelerate(this.player.speed,R.breaking,r):(this.player.accelerating=!1,this.player.speed=E.accelerate(this.player.speed,R.decel,r)),this.cursors.left.isDown?(this.player.turn-=r*(Math.abs(t.curve)>.1?.5:.25),this.cameraAngle+=r):this.cursors.right.isDown?(this.player.turn+=r*(Math.abs(t.curve)>.1?.5:.25),this.cameraAngle-=r):(this.player.turn=Math.abs(this.player.turn)<.01?0:E.interpolate(this.player.turn,0,R.turnResetMultiplier),this.cameraAngle=Math.abs(this.cameraAngle)<.02?0:E.interpolate(this.cameraAngle,0,R.cameraAngleResetMultiplier))}}])&&ae(r.prototype,i),a&&ae(r,a),t}();function ce(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ue(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var de=function(){function e(t,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ue(this,"scene",void 0),ue(this,"speedText",void 0),ue(this,"graphics",void 0),ue(this,"x",void 0),ue(this,"y",void 0),ue(this,"radius",void 0),ue(this,"speedValue",0),this.scene=t,this.x=r,this.y=i,this.radius=a,this.graphics=this.scene.add.graphics(),this.speedText=this.scene.add.bitmapText(r+60,i-17,"retro",this.speedValue.toString(),32).setOrigin(1,.5).setTint(255),this.scene.add.bitmapText(r-12,i-40,"retro","kmh",8).setTint(255),this.update()}var t,r,i;return t=e,(r=[{key:"update",value:function(){this.graphics.clear(),this.drawGauge(),this.speedText.setText(this.speedValue.toString())}},{key:"destroy",value:function(){}},{key:"drawGauge",value:function(){var e=Phaser.Display.Color.HSVToRGB(.3-this.speedValue/600,1,1);this.graphics.lineStyle(17,5592405,1).beginPath().arc(this.x,this.y,this.radius,Phaser.Math.DegToRad(180),Phaser.Math.DegToRad(315),!1).strokePath(),this.graphics.lineStyle(12,e.color).beginPath().arc(this.x,this.y,this.radius,Phaser.Math.DegToRad(183),Phaser.Math.DegToRad(183)+this.speedToAngle(),!1).strokePath()}},{key:"speedToAngle",value:function(){var e=this.speedValue>0?1e3*this.speedValue/R.maxSpeed:0,t=E.interpolate(0,130,.01*e);return Phaser.Math.DegToRad(t)}},{key:"speed",get:function(){return this.speedValue},set:function(e){this.speedValue=e,this.update()}}])&&ce(t.prototype,r),i&&ce(t,i),e}();function pe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var me=17,ge=130,ve=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),fe(this,"scene",void 0),fe(this,"graphics",void 0),fe(this,"container",void 0),fe(this,"bg",void 0),fe(this,"grid",void 0),fe(this,"player",void 0),fe(this,"cars",void 0),fe(this,"x",void 0),fe(this,"y",void 0),this.scene=t,this.x=r,this.y=i,this.cars=new Set,this.container=this.scene.add.container(this.x,this.y),this.bg=this.scene.add.rectangle(0,0,33,163,16777215,.75).setOrigin(0,0),this.grid=this.scene.add.grid(2,2,30,160,30/R.lanes,32,3355443,.8).setOrigin(0,0),this.graphics=this.scene.add.graphics(),this.player=this.scene.add.rectangle(me,ge,3,5,16776960),this.container.add([this.bg,this.grid,this.player,this.graphics])}var t,r,i;return t=e,(r=[{key:"update",value:function(){this.graphics.clear()}},{key:"destroy",value:function(){}},{key:"updatePlayerX",value:function(e){var t=E.interpolate(2,17,e+1);this.player.x=Phaser.Math.Clamp(t,4,30)}},{key:"drawCar",value:function(e,t){var r=E.interpolate(1,16,e+1),i=Phaser.Math.Clamp(r,4,30),a=E.interpolate(0,156,1/(7e-4*t)),n=Phaser.Math.Clamp(a,2,156);this.graphics.fillStyle(16711680).fillRect(i,n,3,5)}}])&&pe(t.prototype,r),i&&pe(t,i),e}();function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Se(e){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var xe=function(e){function t(e,r){var i,a,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=!(n=Se(t).call(this,"RaceUiScene"))||"object"!==ye(n)&&"function"!=typeof n?Me(a):n,Te(Me(i),"timerText",void 0),Te(Me(i),"timeLargeText",void 0),Te(Me(i),"timeSmallText",void 0),Te(Me(i),"speedGauge",void 0),Te(Me(i),"trackRadar",void 0),Te(Me(i),"gameScene",void 0),Te(Me(i),"timer",void 0),i}var r,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(t,l),r=t,(i=[{key:"create",value:function(e){this.gameScene=e,this.timerText=this.add.bitmapText(this.scale.gameSize.width/2+14,5,"retro","time",8).setOrigin(0,0),this.timeLargeText=this.add.bitmapText(this.scale.gameSize.width/2+30,15,"retro","000",16).setOrigin(1,0).setTint(16711680),this.timeSmallText=this.add.bitmapText(this.scale.gameSize.width/2+30,16,"retro","000",8).setOrigin(0,0).setTint(16711680),this.speedGauge=new de(this,60,60,50),this.trackRadar=new ve(this,this.scale.gameSize.width-40,10),this.timer=this.tweens.addCounter({from:180,to:0,duration:18e4}),this.setupEvents()}},{key:"update",value:function(){var e=this.timer.getValue().toFixed(2).split(".");this.timeLargeText.setText(e[0]),this.timeSmallText.setText(e[1]),this.trackRadar.update();var t=this.gameScene.getRadarCars(700),r=!0,i=!1,a=void 0;try{for(var n,s=t[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;this.trackRadar.drawCar(o.offset,o.trackPosition-this.gameScene.player.trackPosition)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"destroy",value:function(){this.registry.events.off("changedata")}},{key:"setupEvents",value:function(){var e=this;this.registry.events.on("changedata",function(t,r,i){switch(r){case"speed":e.speedGauge.speed=i;break;case"playerx":e.trackRadar.updatePlayerX(i);break;default:console.warn("unknown registry change")}},this)}}])&&be(r.prototype,i),a&&be(r,a),t}();function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e){return(Re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r.d(t,"PoisonVialGame",function(){return ke});var ke=function(e){function t(e){var r,i,a,n,s,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,r=!(a=Re(t).call(this,e))||"object"!==Pe(a)&&"function"!=typeof a?Le(i):a,n=Le(r),o=!1,(s="debug")in n?Object.defineProperty(n,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[s]=o,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(t,Phaser.Game),t}();window.onload=function(){var e=new ke(m);if("production"!==window.env.buildType){var t=new(r(9));t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",document.body.appendChild(t.domElement),e.events.on("prestep",function(){return t.begin()}),e.events.on("postrender",function(){return t.end()})}e.scene.add("BootScene",f,!0),e.scene.add("LoadScene",M,!1),e.scene.add("GameScene",he,!1),e.scene.add("RaceUiScene",xe,!1)}}]);